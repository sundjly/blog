ç¿»è¯‘è‡ªï¼š[debugging-react-performance-with-react-16-and-chrome-devtools](https://building.calibreapp.com/debugging-react-performance-with-react-16-and-chrome-devtools-c90698a522ad)

reactæ˜¯ç°åœ¨å‰ç«¯ä¸»è¦æ¡†æ¶ä¹‹ä¸€ï¼Œä¸ä»…å› ä¸ºå®ƒå‡ºåï¼Œæ›´å› ä¸ºå®ƒå‡ºè‰²çš„æ¸²æŸ“æ€§èƒ½ã€‚reactçš„è™šæ‹ŸDOMä»¥é«˜æ•ˆçš„æ¸²æŸ“æ€§èƒ½é—»åï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬é¡¹ç›®ä¼šå‡ºç°æ ¹æœ¬æ„Ÿå—ä¸åˆ°reacté«˜æ•ˆæ€§èƒ½çš„æƒ…å†µï¼Œè¿™æ˜¯æˆ‘ä»¬è¯¥æ€ä¹ˆå®šä½ï¼Œæ€ä¹ˆä¿®å¤å®ƒå‘¢ï¼Ÿ


ä»Šå¤©æˆ‘å°†ç”¨çœŸå®çš„react ä»£ç å’Œchromeå·¥å…·æ¥è¯å®chromeæ–°çš„å¼ºå¤§çš„æ€§èƒ½è¿½è¸ªå·¥å…·çš„ç‰¹æ€§ä»¥åŠæ€ä¹ˆç”¨å®ƒæ¥è¯Šæ–­å‡ºæ¸²æŸ“ç¼“æ…¢çš„ç»„ä»¶ã€‚

å½“ç„¶æ–°çš„æ€§èƒ½å·¥å…·éœ€è¦æ»¡è¶³ä¸‹é¢3ä¸ªæ¡ä»¶ï¼š
1. åœ¨å¼€å‘æ¨¡å¼ä¸­ç”¨React 16
2. ç”¨source-mapså¯¼å‡ºä½ çš„jsï¼ˆè¿™ä¸ªæ˜¯å¯é€‰çš„ï¼Œä½†æ˜¯å¼ºçƒˆæ¨èä½ ï¼‰
3. ä½¿ç”¨Chromeæˆ–è€…Chromiumâ€™s Dev Tools

### åœ¨Chromeä¸­è®¾ç½®ä½ çš„audit
é¦–å…ˆï¼Œä½ éœ€è¦è¶³å¤Ÿçš„ç©ºé—´ï¼Œæœ€å¥½æŠŠå¼€å‘è€…å·¥å…·å¼¹å‡ºæ¥ï¼Œä½¿å®ƒå’Œä½ çš„å±å¹•ä¸€æ ·å¤§ï¼Œé‚£æ ·æ˜¯æœ€å¥½çš„ã€‚

[![1_-vtAWWryE6dtsPXkuOU7xQ.gif](https://user-gold-cdn.xitu.io/2019/3/14/1697b6a8e2ca425c?w=800&h=261&f=gif&s=331014)](https://user-gold-cdn.xitu.io/2019/3/14/1697b6a8e2ca425c?w=800&h=261&f=gif&s=331014)

æˆ‘ä»¬åº”è¯¥ç”¨chromeçš„audit åŠŸèƒ½æ¨¡æ‹ŸçœŸå®ç¯å¢ƒä¸­ä»£ç çš„è¿è¡Œæƒ…å†µï¼Œè¿™æ˜¯å¿…ä¸å¯å°‘çš„ã€‚ä¸æ˜¯æ¯ä¸ªäººéƒ½æœ‰ä»·å€¼3000ç¾å…ƒçš„ç”µè„‘æˆ–è€…æœ€æ–°çš„æ‰‹æœºã€‚

å¹¸è¿çš„æ˜¯ï¼ŒChromeå¯¹äºè®¾å¤‡æ¨¡æ‹Ÿè¦†ç›–å¹¿æ³›ï¼Œæˆ‘ä»¬èƒ½å¤Ÿé™ä½javascriptçš„æ‰§è¡Œé€Ÿåº¦ï¼Œé€šè¿‡è¿™ä¸ªæˆ‘ä»¬èƒ½æ¸…æ™°çš„å‘ç°æ€§èƒ½é—®é¢˜ï¼Œè¿˜æœ‰é¢å¤–çš„å¥½å¤„ï¼Œå¦‚æœä½ èƒ½åšåˆ°åœ¨ç¡¬ä»¶ä¸€èˆ¬çš„è®¾å¤‡è¿è¡Œå¿«é€Ÿè¿è¡Œï¼Œé‚£ä¹ˆæ¡Œé¢ä¸Šå°±èƒ½ä½“éªŒé£ä¸€èˆ¬çš„æ„Ÿè§‰ã€‚
[![1_aL8cq4bJxsH4RcTFblGfBg.gif](https://user-gold-cdn.xitu.io/2019/3/14/1697c2943d722241?w=800&h=188&f=gif&s=455785)](https://user-gold-cdn.xitu.io/2019/3/14/1697c2943d722241?w=800&h=188&f=gif&s=455785)
é™ä½ä½ å¾—è®¾å¤‡è‡³å°‘åˆ°4xå°±å°†å’ŒMotorola Moto G4ï¼ˆæ‘©æ‰˜ç½—æ‹‰æ‰‹æœºï¼‰ä¸€æ ·çš„æ€§èƒ½

### æŸ¥çœ‹æ€§èƒ½è·Ÿè¸ª
åœ¨å¼€å‘è€…æ¨¡å¼ï¼Œä»¥åŠreact 16ç‰ˆæœ¬æ¸²æŸ“çš„æ¡ä»¶ä¸‹ï¼Œå®ƒä¼šä¸ºæ¯ä¸€ä¸ªç»„ä»¶åˆ›å»ºæ ‡è®°ä¸ç›¸å…³å…·ä½“çš„è°ƒç”¨ã€‚

é¦–å…ˆï¼Œæ‰“å¼€ï¼ˆæœ¬åœ°çš„ï¼‰éœ€è¦æµ‹è¯•çš„é¡µé¢ï¼Œç‚¹å‡»â€˜Start profiling and reload pageâ€™æŒ‰é’®ï¼Œè¿™æ ·å°±åˆ›å»ºäº†ä¸€ä¸ªå¯¹é¡µé¢çš„æ€§èƒ½åˆ†æè®°å½•ï¼ˆa performance profiler auditï¼‰ã€‚

è¿™å°†ä¼šä¸ºå½“å‰é¡µé¢è®°å½•æ€§èƒ½è½¨è¿¹ã€‚åœ¨é¡µé¢åŠ è½½å®Œæˆå‡ ç§’é’Ÿä¹‹åï¼ŒChromeå°†ä¼šè‡ªåŠ¨åœæ­¢è®°å½•ã€‚
[![1_KXQKkbo8Ujfd8JcRDK9RAA.gif](https://user-gold-cdn.xitu.io/2019/3/15/1697f42f5ba6433b?w=800&h=465&f=gif&s=707818)](https://user-gold-cdn.xitu.io/2019/3/15/1697f42f5ba6433b?w=800&h=465&f=gif&s=707818)
æˆ–è€…ï¼Œä½¿ç”¨é”®ç›˜å¿«æ·é”®ï¼šâŒ˜+â‡§E

ä¸€æ—¦ä½ å¼€å§‹è®°å½•ï¼Œä½ çš„çª—å£çœ‹èµ·æ¥æ˜¯è¿™ä¸ªæ ·å­ï¼š

[![1_JH7OdBXRtDjxLUqGT3b51A.png](https://user-gold-cdn.xitu.io/2019/3/15/1697f47fa81fe008?w=1200&h=940&f=png&s=204930)](https://user-gold-cdn.xitu.io/2019/3/15/1697f47fa81fe008?w=1200&h=940&f=png&s=204930)
æˆ‘ä»¬èƒ½çœ‹åˆ°ä¸€æ¡ä»å·¦åˆ°å³çš„è®°å½•æˆ‘ä»¬é¡µé¢åŠ è½½å’Œåˆå§‹åŒ–çš„æ—¶é—´è½´

æˆ‘æƒ³èŠ±ä¸€ä¸¤ç§’é’ŸæŒ‡å‡ºä¸€äº›å¯¹æ€§èƒ½å·¥å…·ä½¿ç”¨çš„æ–°äººæ¥è¯´ä¸å¤ªæ˜æ˜¾çš„äº‹æƒ…ã€‚
1. å¦‚ä¸Šå›¾ä¸­â‘ æ‰€ç¤ºï¼Œçº¢è‰²çš„æŒ‡ç¤ºæ¨ªæ¡è¯´æ˜åœ¨æ—¶é—´è½´è¿™éƒ¨åˆ†å ç”¨äº†å¤§é‡cpuèµ„æºï¼ˆè¾ƒé•¿çš„ä»»åŠ¡æ‰§è¡Œï¼‰ï¼Œæˆ‘ä»¬åº”è¯¥å¯¹è¿™ä¸ªåœ°æ–¹è¿›è¡Œåˆ†æ
2. performanceé¡¶éƒ¨çª—å£å›¾è¡¨ä½¿ç”¨ä¸åŒçš„é¢œè‰²ä»£è¡¨ä¸åŒç±»å‹çš„æ´»åŠ¨ã€‚æ¯ä¸ªç±»åˆ«éƒ½éœ€è¦ä¸åŒçš„åˆ†æï¼Œä¿®å¤ï¼Œé€ æˆæ€§èƒ½çš„åŸå› ä¹Ÿä¸åŒã€‚


ç°åœ¨æˆ‘ä»¬å…ˆèšç„¦åœ¨â€œScriptingâ€ï¼ˆJavaScriptè¿è¡Œæ—¶æ€§èƒ½ï¼‰

![JavaScriptè¿è¡Œæ—¶æ€§èƒ½](https://user-gold-cdn.xitu.io/2019/3/15/169802f95c22c484?w=800&h=727&f=gif&s=4081149)
å±•å¼€çª—å£ï¼Œå•å‡»æ‰“å¼€ç”¨æˆ·è®¡æ—¶ï¼Œç”¨æˆªå±æ—¶é—´çº¿æ¥åˆ†æä½ çš„é¡µé¢å¦‚ä½•ç»˜åˆ¶çš„ğŸ‘€

æ¥ä¸‹æ¥æˆ‘ä»¬è¦å»åˆ†æé‚£äº›cpuå ç”¨é«˜æ˜¾ç¤ºçº¢è‰²çš„éƒ¨åˆ†ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨æ•´ä¸ªæ€§èƒ½è·Ÿè¸ªæœŸé—´é¡µé¢æ¸²æŸ“çš„å…ƒç´ ã€‚

![](https://user-gold-cdn.xitu.io/2019/3/15/169803452d317532)
åœ¨å›¾è¡¨åŒºåŸŸæ‹–æ‹½å¯ä»¥ç¼©æ”¾æ—¶é—´è½´ï¼Œä½ æ³¨æ„åˆ°emoji âš›ï¸äº†å—?

ä¸€ç¼©æ”¾ç«‹å³å°±ä¼šæ˜¾ç¤ºç”¨æˆ·èŠ±è´¹æ—¶é—´ä¿¡æ¯ï¼Œç„¶åæˆ‘ä»¬è§‚å¯Ÿåˆ°ä¸€ä¸ªå«Pulseçš„ç»„ä»¶ï¼Œå®ƒèŠ±è´¹äº†500msæ—¶é—´æ¸²æŸ“ã€‚

åœ¨Pulseç»„ä»¶çš„ä¸‹é¢ï¼Œå¯ä»¥çœ‹åˆ°å®ƒçš„å­ç»„ä»¶çš„æ¸²æŸ“ï¼Œå°½ç®¡ç»„ä»¶çš„å¤§å°è¡¨æ˜å®ƒä»¬æ¸²æŸ“ä¸ä¼šèŠ±è´¹è¿™ä¹ˆé•¿æ—¶é—´ã€‚

### å‘ç°æ‰§è¡Œæ…¢çš„å‡½æ•°

![](https://user-gold-cdn.xitu.io/2019/3/15/16980436151dba97?w=1200&h=506&f=png&s=133963)
1. å•å‡»ä½ è¦åˆ†æçš„ç»„ä»¶ï¼Œåœ¨è¿™é‡Œå°±æ˜¯Pulseã€‚ç„¶åæˆ‘ä»¬åªéœ€å…³æ³¨åœ¨Pulseç»„ä»¶æ‰§è¡Œç¼“æ…¢çš„éƒ¨åˆ†ã€‚
2. é€‰æ‹©æ€§èƒ½å¼€å‘å·¥å…·ä¸­â€œBottom-Upâ€.
3. æŒ‰ç…§æ€»æ—¶é—´ï¼ˆtotal timeï¼‰ä»é«˜åˆ°ä½æ’åºï¼Œå½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥æŒ‰ç…§è‡ªå·±æœ¬èº«æ—¶é—´ï¼ˆSelf timeï¼‰æˆ–è€…é™¤äº†URLä»¥å¤–ä¸œè¥¿æ’åºã€‚æ€»ä¹‹ï¼Œæ€ä¹ˆé€‚åˆä½ åˆ†æï¼Œæ€ä¹ˆæ’åºæœ€å¥½ã€‚
4. åœ¨ä½ éœ€è¦åˆ†æä»£ç çš„åœ°æ–¹æœ‰ä¸ªç®­å¤´ï¼Œç‚¹å‡»å®ƒï¼Œåœ¨è¿™é‡Œå°±æ˜¯map çœ‹èµ·æ¥æ˜¯å¯ç–‘çš„ã€‚å®ƒè¢«è°ƒç”¨äº†å¾ˆå¤šæ¬¡ï¼Œæ€»å…±æ‰§è¡Œæ—¶é—´ä¸º90msã€‚
5. **è¿™å°±æ˜¯ä½ ä¸ºä»€ä¹ˆéœ€è¦sourcemapsçš„åŸå› ï¼šç‚¹å‡» `MetricStore.js:59`å°†ä¼šæ‰“å¼€ä»£ç å¹¶å®šä½åˆ°59è¡Œ**


![](https://user-gold-cdn.xitu.io/2019/3/15/169804fcf8e34433?w=800&h=986&f=png&s=261675)
åœ¨ä»£ç æ‰§è¡ŒèŠ±è´¹è¾ƒé•¿çš„å·¦è¾¹å°±ä¼šæœ‰ä¸€ä¸ªæ—¶é—´æ ‡è¯†ï¼ˆå¤§æ¦‚è¿™ä¸æ˜¯æˆ‘å‘ä¸–ç•Œå±•ç¤ºæˆ‘ä»£ç çš„æœ€ä½³æ—¶æœºï¼‰

### å½“ä½ çŸ¥é“æ€ä¹ˆåŸå› æ”¹è¿›å®ƒæ˜¯ç®€å•çš„
åœ¨è¿‡å»çš„å‡ å‘¨é‡Œï¼Œæˆ‘é€šè¿‡è¿™æ ·çš„æ–¹æ³•å®ç°äº†ä¹‹å‰å¾ˆå¤æ‚ï¼Œéœ€è¦èŠ±è´¹å¾ˆå¤šè§£å†³çš„ä»£ç çš„ä¼˜åŒ–å·¥ä½œã€‚ç°åœ¨æˆ‘å®Œå…¨çŸ¥é“å¦‚ä½•ä»¥åŠåœ¨å“ªé‡Œå¯»æ‰¾JavaScriptæ€§èƒ½é—®é¢˜ã€‚æˆ‘ä¹Ÿç¡®ä¿¡åœ¨æœªæ¥æˆ‘èƒ½å†™å‡ºæ›´å¥½çš„ä»£ç ã€‚

...
å¹¿å‘Šæ»¤è¿‡
...

### ä¸ºä»€ä¹ˆReactçš„åˆ†æå·¥å…·ä¼šåœ¨Chromeé‡Œé¢ï¼Ÿ
åœ¨reactå†…éƒ¨ï¼Œreactå‘å¸ƒçš„è¿™äº›å·¥å…·ä¹Ÿæ˜¯é€šè¿‡[User Timing API](https://developer.mozilla.org/en-US/docs/Web/API/User_Timing_API)ï¼Œå®ƒå°±ä¼šåœ¨ä½ çš„ä»£ç é‡Œé¢æ·»åŠ æ—¶é—´æ ‡è®°ï¼Œè€ŒChromeåˆ©ç”¨User Timing APIå®ç°è¿™ä¸ªåŠŸèƒ½ã€‚

> æƒ³è±¡ä¸€ä¸‹ä¸€ä¸ªç»„ä»¶åˆå§‹åŒ–èŠ±è´¹0.4sï¼Œç”¨æˆ·ç‚¹å‡»è´­ä¹°æŒ‰é’®èŠ±è´¹15sæ—¶é—´

å…³äºUser Timing APIçš„ä»‹ç»ï¼Œå¯ä»¥çœ‹çœ‹[ Alex Danilo](https://twitter.com/alexanderdanilo)åœ¨2014å¹´å‘è¡¨çš„[User Timing API](https://www.html5rocks.com/en/tutorials/webperformance/usertiming/)ï¼Œè¿™æ˜¯åå‰¯å…¶å®çš„HTML5 åŸºçŸ³çš„æ–‡ç« ã€‚

æ‰€æœ‰çš„ä¸»æµæµè§ˆå™¨éƒ½å·²ç»æ”¯æŒUser Timing APIï¼Œä½†æ˜¯åœ¨Chromeä¸­é€šè¿‡debuggingæ›´ç®€å•æ–¹ä¾¿è°ƒè¯•ä¸€ä¸ªReactåº”ç”¨è¿˜éœ€è¦èµ°ä¸€æ®µæ—¶é—´çš„è·¯ã€‚


### æœ€ä¼˜åŒ–ä½ çš„JavaScript
æˆ‘è¡·å¿ƒçš„å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¤Ÿæå‡ä½ æ€§èƒ½åˆ†æçš„æ°´å¹³ã€‚è¯·ç•™ä¸‹è¯„è®ºï¼Œåˆ†äº«ä½ å­¦åˆ°çš„ä¸œè¥¿æˆ–è€…æ”¹è¿›ä½ çš„åº”ç”¨çš„æ–¹æ³•ğŸ™‹ï¼


å¦‚æœæœ‰é”™è¯¯æˆ–è€…ä¸ä¸¥è°¨çš„åœ°æ–¹ï¼Œè¯·åŠ¡å¿…ç»™äºˆæŒ‡æ­£ï¼Œååˆ†æ„Ÿè°¢!
### å‚è€ƒ
1. [https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/timeline-tool?hl=zh-cn](https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/timeline-tool?hl=zh-cn)